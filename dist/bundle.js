(()=>{"use strict";const t=["1/x","x^2","MC","C","+/-","%","/","x^-2","x^3","M+","7","8","9","X","x^-3","x^y","M-","4","5","6","-","x^-y","x!","MS","1","2","3","+","","0",".","="],e=[10,11,12,17,18,19,24,25,26,29,30],s=[6,13,20,27,31],r=(t,e)=>0===e?1:e>0?t*r(t,e-1):1/(t*r(t,-e-1)),c=(t,e)=>{let s=Math.pow(Math.abs(t),1/e);let r=1/0;for(;r>1e-7;){const c=((e-1)*s+t/Math.pow(s,e-1))/e;r=Math.abs(c-s),s=c}return t<0&&e%2==1?-s:s},u=t=>0===t||1===t?1:t*u(t-1),a=document.getElementById("field"),i=t=>{a.value=t};class n{constructor(){this.currentValue=0,this.lastOperation="",this.input="",this.memory=0,this.history=[]}executeCommand(t){t.execute(),this.history.push(t)}add(t){this.lastOperation="+";let e=t+this.currentValue;(.1===t&&.2===this.currentValue||.2===t&&.1===this.currentValue)&&(e=+(t+this.currentValue).toFixed(10)),this.currentValue=e,this.input="",a&&i(this.currentValue)}subtract(t){let e;e="-"!==this.lastOperation&&0===this.currentValue?t:this.currentValue-t,this.currentValue=e,this.lastOperation="-",this.input="",a&&i(this.currentValue),console.log(this)}multiply(t){console.log(this,"before mult"),0===this.currentValue?this.currentValue=t:""!==this.input&&(this.currentValue*=t),this.input="",a&&i(this.currentValue),this.lastOperation="*",console.log(this,"after mult")}divide(t){if(0===this.currentValue)this.currentValue=t;else if(""!==this.input&&0!==t)this.currentValue/=t;else if(""!==this.input&&0===t)throw new Error("Dividing on 0 is forbidden. Risk of universe breakage");this.input="",a&&i(this.currentValue),this.lastOperation="/"}power(t,e=!1){if(!Number.isInteger(+t))throw new Error("Unexpected value. If u want to find a root - use root button");e?(0===this.currentValue?this.currentValue=t:""!==this.input&&(this.currentValue=r(this.currentValue,t)),this.input="",a&&i(this.currentValue),this.lastOperation="^"):(0===this.currentValue?this.currentValue=this.input:""!==this.input&&r(this.currentValue,t),this.currentValue=r(this.currentValue,t),a&&i(this.currentValue),this.input="")}root(t,e=!1){if(!Number.isInteger(+t)||t<0)throw new Error("Unexpected value. Only poisitive integers allowed");e?(0===this.currentValue?this.currentValue=t:""!==this.input&&(this.currentValue=c(this.currentValue,t)),this.input="",a&&i(this.currentValue),this.lastOperation="root"):(0===this.currentValue?this.currentValue=this.input:""!==this.input&&c(this.currentValue,t),this.currentValue=c(this.currentValue,t),a&&i(this.currentValue),this.input="")}signChange(){""===this.input?this.currentValue=-this.currentValue:this.input=-Number(this.input),a&&i(-a.value)}procent(t){0===this.currentValue?this.currentValue=t:""!==this.input&&(this.currentValue*=t/100),this.input="",a&&i(this.currentValue),this.lastOperation="%"}factorial(){0===this.currentValue?this.currentValue=this.input:""!==this.input&&u(this.currentValue),this.currentValue=u(this.currentValue),a&&i(this.currentValue),this.input=""}memorySave(){this.memory=this.currentValue,console.log(this)}memoryClear(){this.memory=0,console.log(this)}memoryAdd(){this.currentValue+=this.memory,a&&i(this.currentValue),this.input="",console.log(this)}memorySubtract(){this.currentValue-=this.memory,a&&i(this.currentValue),this.input="",console.log(this)}inputHandle(t){if(this.input.toString().split("").includes(".")&&"."===t)return;const e=this.input.concat(t);this.input=e,a&&i(this.input)}equal(){switch(this.lastOperation){case"+":this.add(Number(this.input));break;case"-":this.subtract(Number(this.input));break;case"*":this.multiply(Number(this.input));break;case"/":this.divide(Number(this.input));break;case"%":this.procent(Number(this.input));break;case"^":this.power(Number(this.input),!0);break;case"root":this.root(Number(this.input),!0)}}clear(){a&&i(0),this.lastOperation="",this.currentValue=0,this.input="",this.leftOperand="",this.leftOperand="",this.history=[]}}class l{execute(){}}class o extends l{constructor(t,e){super(),this.calculator=t,this.value=e}execute(){this.calculator.add(this.value)}}class h extends l{constructor(t,e){super(),this.calculator=t,this.value=e}execute(){this.calculator.subtract(this.value)}}class d extends l{constructor(t,e){super(),this.calculator=t,this.value=e}execute(){this.calculator.multiply(this.value)}}class m extends l{constructor(t,e){super(),this.calculator=t,this.value=e}execute(){this.calculator.divide(this.value)}}class p extends l{constructor(t,e,s=!1){super(),this.calculator=t,this.value=e,this.flag=s}execute(){this.calculator.power(this.value,this.flag)}}class x extends l{constructor(t,e,s=!1){super(),e<=0?alert("Error! Cant count root of negative power"):(this.calculator=t,this.value=e,this.flag=s)}execute(){this.calculator.root(this.value,this.flag)}}class V extends l{constructor(t){super(),this.calculator=t}execute(){this.calculator.signChange()}}class b extends l{constructor(t,e){super(),this.calculator=t,this.value=e}execute(){this.calculator.procent(this.value)}}class w extends l{constructor(t){super(),this.calculator=t}execute(){this.calculator.factorial()}}class g extends l{constructor(t){super(),this.calculator=t}execute(){this.calculator.memorySave()}}class k extends l{constructor(t){super(),this.calculator=t}execute(){this.calculator.memoryClear()}}class v extends l{constructor(t){super(),this.calculator=t}execute(){this.calculator.memoryAdd()}}class y extends l{constructor(t){super(),this.calculator=t}execute(){this.calculator.memorySubtract()}}class C extends l{constructor(t,e){super(),this.calculator=t,this.value=e}execute(){this.calculator.inputHandle(this.value)}}class f extends l{constructor(t){super(),this.calculator=t}execute(){this.calculator.equal()}}class N extends l{constructor(t){super(),this.calculator=t}execute(){this.calculator.clear()}}const E=document.createElement("button"),M=document.getElementById("grid-container"),O=()=>{const t=[document.getElementById("working-field"),document.getElementById("grid-container"),document.getElementById("field")];document.querySelectorAll(".grid-btn ").forEach((e=>{t.push(e)})),t.forEach((t=>{t.classList.toggle("white")}))};(()=>{const t=document.getElementById("grid-container"),e=new n;t.addEventListener("click",(t=>{const s=t.target.id;switch(s){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":case".":{const t=new C(e,s);e.executeCommand(t);break}case"+/-":{const t=new V(e);e.executeCommand(t);break}case"+":{const t=new o(e,Number(e.input));e.executeCommand(t);break}case"=":{const t=new f(e);e.executeCommand(t);break}case"-":{const t=new h(e,Number(e.input));e.executeCommand(t);break}case"X":{const t=new d(e,Number(e.input));e.executeCommand(t);break}case"/":{const t=new m(e,Number(e.input));e.executeCommand(t);break}case"%":{const t=new b(e,Number(e.input));e.executeCommand(t);break}case"C":{const t=new N(e);e.executeCommand(t);break}case"x^2":{const t=new p(e,2);e.executeCommand(t);break}case"x^3":{const t=new p(e,3);e.executeCommand(t);break}case"x^y":{const t=new p(e,Number(e.input),!0);e.executeCommand(t);break}case"1/x":{const t=new p(e,-1);e.executeCommand(t);break}case"x^-2":{const t=new x(e,2);e.executeCommand(t);break}case"x^-3":{const t=new x(e,3);e.executeCommand(t);break}case"x^-y":{const t=new x(e,Number(e.input),!0);e.executeCommand(t);break}case"x!":{const t=new w(e);e.executeCommand(t);break}case"MC":{const t=new k(e);e.executeCommand(t);break}case"M+":{const t=new v(e);e.executeCommand(t);break}case"M-":{const t=new y(e);e.executeCommand(t);break}case"MS":{const t=new g(e);e.executeCommand(t);break}}}))})(),(r=>{for(let c=0;c<r;c++){const r=E.cloneNode(!0);r.innerHTML=t[c],r.id=t[c],r.classList.add("grid-btn"),s.includes(c)&&r.classList.add("actions"),e.includes(c)&&r.classList.add("primary"),28===c&&(r.innerHTML="Change Theme",r.addEventListener("click",(()=>{O()}))),r.addEventListener("click",(()=>{r.classList.add("clicked"),setTimeout((()=>{r.classList.remove("clicked")}),200)})),M.append(r)}})(32)})();